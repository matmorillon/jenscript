// JenScript -  JavaScript HTML5/SVG Library
// Product of JenSoftAPI - Visualization Java & JS Libraries
// version : 1.1.9
// Author : Sebastien Janaud 
// Web Site : http://jenscript.io
// Twitter  : http://twitter.com/JenSoftAPI
// Copyright (C) 2008 - 2015 JenScript, product by JenSoftAPI company, France.
// build: 2016-06-16
// All Rights reserved

!function(){JenScript.Grid=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.Grid,{init:function(a){a=a||{},this.deviceValue,this.userValue,this.metricsMarkerColor,this.metricsLabelColor,this.format,this.gridLabel,this.lockMarker,this.lockLabel,this.visible=!0},setDeviceValue:function(a){this.deviceValue=a},setUserValue:function(a){this.userValue=a},getDeviceValue:function(){return this.deviceValue},getUserValue:function(){return this.userValue}})}(),function(){JenScript.AbstractGridPlugin=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.AbstractGridPlugin,JenScript.Plugin),JenScript.Model.addMethods(JenScript.AbstractGridPlugin,{_init:function(a){a=a||{},a.name=void 0!==a.name?a.name:"AbstractGridPlugin",a.priority=-1e4,this.gridOrientation=a.gridOrientation,this.gridColor=a.gridColor,this.gridWidth=void 0!==a.gridWidth?a.gridWidth:1,this.gridOpacity=void 0!==a.gridOpacity?a.gridOpacity:1,JenScript.Plugin.call(this,a)},onProjectionRegister:function(){var a=this;this.getProjection().addProjectionListener("boundChanged",function(){a.repaintPlugin()},a.toString())},getGridManager:function(){throw new Error("Abstract, grid manager should be supplied.")},paintGrids:function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.deviceValue,f=this.gridOrientation,g=void 0!==this.gridColor?this.gridColor:this.getProjection().themeColor,h="Vertical"===f?e:0,i="Vertical"===f?0:e,j="Vertical"===f?e:this.getProjection().getPixelWidth(),k="Vertical"===f?this.getProjection().getPixelHeight():e,l=(new JenScript.SVGLine).Id("grid"+JenScript.sequenceId++).from(h,i).to(j,k).stroke(g).strokeWidth(this.gridWidth).strokeOpacity(this.gridOpacity).fillNone();a.insertSVG(l.toSVG())}},paintPlugin:function(a,b){if(b==JenScript.ViewPart.Device){this.getGridManager().setGridsPlugin(this);var c=this.getGridManager().getGrids();this.paintGrids(a,c)}}})}(),function(){JenScript.GridManager=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.GridManager,{init:function(a){a=a||{}},getOrientation:function(){return this.getGridsPlugin().gridOrientation},setGridsPlugin:function(a){this.gridsPlugin=a},getGridsPlugin:function(){return this.gridsPlugin},getProjection:function(){return this.getGridsPlugin().getProjection()},getGrids:function(){}})}(),function(){JenScript.GridsExponentModel=function(a){this.init(a)},JenScript.Model.addMethods(JenScript.GridsExponentModel,{init:function(a){a=a||{},this.exponent=a.exponent,this.factor=a.factor,this.gridsManager,this.ref,this.maxValue,this.pixelLabelHolder,this.solveType="major"},getGridsManager:function(){return this.gridsManager},setGridsManager:function(a){this.gridsManager=a},generateMedianGrids:function(){this.solveType="median",this.solve();var a=this.factor;this.factor=this.factor.multiply(.5);for(var b=this,c=function(){return b.exponent<0?new JenScript.BigNumber("0").equals(this.userValue)?"0":this.userValue.toFixed(Math.abs(b.exponent)+1):this.userValue},d=this.generateGrids(),e=0;e<d.length;e++)d[e].median=!0,d[e].format=c;return this.factor=a,d},generateGrids:function(){this.solveType="major",this.solve();var a=[],b=!0,c=this.ref,d=this,e=function(){return d.exponent<0?new JenScript.BigNumber("0").equals(this.userValue)?"0":this.userValue.toFixed(Math.abs(d.exponent)):this.userValue},f=this.getGridsManager().generateGrid(c.toNumber(),this);for(void 0!==f&&(a[a.length]=f,f.major=!0,f.format=e);b;){c=c.add(this.factor);var g=this.getGridsManager().generateGrid(c.toNumber(),this);void 0!==g&&(g.major=!0,g.format=e,a[a.length]=g),c.greaterThanOrEqualTo(this.maxValue)&&(b=!1)}return a},solve:function(){var a=this.getGridsManager().getProjection();if("Vertical"===this.getGridsManager().getOrientation()){this.userSize=new JenScript.BigNumber(a.getUserWidth()+""),JenScript.BigNumber.config({ROUNDING_MODE:JenScript.BigNumber.ROUND_CEIL});var b=new JenScript.BigNumber(a.getMinX()+"").divide(this.factor),c=new JenScript.BigNumber(b.toFixed(0));this.ref=new JenScript.BigNumber(c).multiply(this.factor),this.ref=this.ref.subtract(this.factor),this.ref.equals(0)&&(this.ref=this.ref.subtract(this.factor)),this.pixelSize=new JenScript.BigNumber(a.getPixelWidth()+""),this.maxValue=new JenScript.BigNumber(a.getMaxX()+"")}else if("Horizontal"===this.getGridsManager().getOrientation()){this.userSize=new JenScript.BigNumber(a.getUserHeight()+""),JenScript.BigNumber.config({ROUNDING_MODE:JenScript.BigNumber.ROUND_CEIL});var b=new JenScript.BigNumber(a.getMinY()+"").divide(this.factor),c=new JenScript.BigNumber(b.toFixed(0));this.ref=new JenScript.BigNumber(c).multiply(this.factor),this.ref=this.ref.subtract(this.factor),this.ref.equals(0)&&(this.ref=this.ref.subtract(this.factor)),this.pixelSize=new JenScript.BigNumber(a.getPixelHeight()+""),this.maxValue=new JenScript.BigNumber(a.getMaxY()+"")}JenScript.BigNumber.config({ROUNDING_MODE:JenScript.BigNumber.ROUND_HALF_EVEN}),"major"===this.solveType?this.pixelLabelHolder=80:"median"===this.solveType?this.pixelLabelHolder=60:"minor"===this.solveType&&(this.pixelLabelHolder=8)},isValid:function(){this.solve();var a=this.userSize.divide(this.factor).multiply(new JenScript.BigNumber(this.pixelLabelHolder)).compareTo(this.pixelSize);return-1===a?!0:!1}}),JenScript.GridManagerModeled=function(a){this._init(a)},JenScript.Model.inheritPrototype(JenScript.GridManagerModeled,JenScript.GridManager),JenScript.Model.addMethods(JenScript.GridManagerModeled,{_init:function(a){a=a||{},JenScript.GridManager.call(this,a),this.gridsModels=[]},createSymmetricListModel:function(a){for(var b=[],c=-a;a>=c;c++){var d=this.createExponentModel(c);b[b.length]=d}return b},createExponentModel:function(a){var b=void 0,c="";if(0>a){c+="0.";for(var d=1;d<Math.abs(a);d++)c+="0";c+="1";var e=c;b=new JenScript.GridsExponentModel({exponent:a,factor:new JenScript.BigNumber(e)})}else if(a>0){c+="1";for(var d=1;d<=Math.abs(a);d++)c+="0";var e=c;b=new JenScript.GridsExponentModel({exponent:a,factor:new JenScript.BigNumber(e)})}else 0==a&&(b=new JenScript.GridsExponentModel({exponent:0,factor:new JenScript.BigNumber("1")}));return b},registerGridModel:function(a){a.setGridsManager(this),this.gridsModels[this.gridsModels.length]=a,this.gridsModels.sort(function(a,b){return a.factor.compareTo(b.factor)})},registerGridModels:function(a){for(var b=0;b<a.length;b++)this.registerGridModel(a[b])},getGrids:function(){for(var a=[],b=[],c=0;c<this.gridsModels.length;c++){var d=this.gridsModels[c].isValid();if(d){a=this.gridsModels[c].generateGrids();var e=function(b){for(var c=0;c<a.length;c++)if(b.userValue===a[c].userValue)return!0;return!1};if(a.length<4)for(var f=this.gridsModels[c].generateMedianGrids(),g=0;g<f.length;g++)e(f[g])||(b[b.length]=f[g]);return[].concat(a,b)}}},generateGrid:function(a){var b=new JenScript.Grid,c=this.getProjection(),d=0,e=0;return"Vertical"===this.getOrientation()?(d=c.userToPixelX(a),e=c.getPixelWidth()):"Horizontal"===this.getOrientation()&&(d=c.userToPixelY(a),e=c.getPixelHeight()),0>d||d>e?void 0:(b.setDeviceValue(d),b.setUserValue(a),b)}})}(),function(){JenScript.GridModeledPlugin=function(a){this.__init(a)},JenScript.Model.inheritPrototype(JenScript.GridModeledPlugin,JenScript.AbstractGridPlugin),JenScript.Model.addMethods(JenScript.GridModeledPlugin,{__init:function(a){a=a||{},a.name="GridModeledPlugin",this.gridManager=new JenScript.GridManagerModeled(a);var b=this.gridManager.createSymmetricListModel(20);this.gridManager.registerGridModels(b),JenScript.AbstractGridPlugin.call(this,a)},getGridManager:function(){return this.gridManager}})}();